# Binary Protections

## Address Space Layout Randomisation

### Information Leak

Any form of information leak can be used to bypass ASLR.

### CVE-2016-3672

{% embed data="{\"url\":\"http://hmarco.org/bugs/CVE-2016-3672-Unlimiting-the-stack-not-longer-disables-ASLR.html\",\"type\":\"link\",\"title\":\"CVE-2016-3672 - Unlimiting the stack not longer disables ASLR\"}" %}

### \_\_vsyscall

The vsyscall page is constant regardless of ASLR and contains three simulated syscalls.  They aren't traditional ROP gadgets and can't be utilised as a regular syscall, but the one attack they can be used for is one which requires climbing the stack.  This can be due to a partial overwrite attack, or some form where a useful value lies up the stack.

[On vsyscalls and the vDSO](https://lwn.net/Articles/446528/) discusses some of the reasons for moving to the current form of vsyscall and how certain attacks utilising it have been phased out.

## Stack Canaries

```text
mov    rcx,QWORD PTR [rbp-0x8]
xor    rcx,QWORD PTR fs:0x28
je     0xc5c <rand_function+237>
call   0x920 <__stack_chk_fail@plt>
leave
ret
```

In this case the stack canary is at `rbp-0x8`, just adjacent to the frame pointer.  If we overwrite a buffer, we'll overwrite this and the xor comparison will fail, resulting in an early exit from the program.

### Bypasses

A good starting point is to identify the system the binary is run on.  Stack canaries for at least Ubuntu systems begin with a null-byte.  This is intended to cut several exploitation techniques in their tracks, depending on how the data is read, as a null-byte will signify the end of a string for many C functions.  If such a situation ocurrs then an overflow may not be exploitable at all.

An information leak such as a format string which allows you to read the stack can be leveraged in such a way as to leak the original stack canary.  Reading far enough up the stack is usually sufficient to exfiltrate the canary.

